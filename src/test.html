<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HTML5 Audio API Test</title>
	<style>
	body {
		background-color: #CCC;
	}

	#canvas {
		border: 1px solid #000;
		background-color: #333;
	}
	</style>
</head>
<body>
	<h1>Title Offset</h1>
	<canvas id="canvas" width="480" height="320">
		Please use a modern browser with JavaScript enabled to play the game!
		Canvas is not supported on your current browser.
	</canvas>
	<script>
	function Sound(source) {
		if(!window.audioContext) {
			audioCtx = new AudioContext;
		}

		var that = this;
		that.source = source;
		that.buffer = null;
		that.isLoaded = false;

		var getSound = new XMLHttpRequest();
		getSound.open('GET', that.source, true);
		getSound.responseType = 'arraybuffer';
		getSound.onload = function() {
			audioCtx.decodeAudioData(getSound.response, function(buffer) {
				that.buffer = buffer;
				that.isLoaded = true;
			});
		}

		getSound.send();
	}

	Sound.prototype.play = function(volLevel) {
		if(this.isLoaded === true) {
			var playSound = audioCtx.createBufferSource();
			playSound.buffer = this.buffer;

			var volume = audioCtx.createGain();
			playSound.connect(volume);
			if(volLevel) {
				volume.gain.value = volLevel;
			} else {
				volume.gain.value = 0.1;
			}
			volume.connect(audioCtx.destination);

			playSound.start(0);
		}
	}

	function touchStartHand(evt) {
		evt.preventDefault();
		console.log(evt.changedTouches[0].pageX, evt.changedTouches[0].pageY);
	}

	function touchEndHand(evt) {
		evt.preventDefault();
		console.log(evt.changedTouches[0].pageX, evt.changedTouches[0].pageY);
	}

	window.onload = function() {
		var canvas = document.getElementById('canvas');
		var ctx = canvas.getContext('2d');

		ctx.fillStyle = '#00ff00';
		ctx.fillRect(10, 10, 10, 10);

		var selSfx = new Sound('sounds/select.wav');
		var scoreSfx = new Sound('sounds/score.wav');

		canvas.addEventListener('touchstart', touchStartHand, false);
		canvas.addEventListener('touchend', touchEndHand, false);

		window.onmousedown = function(evt) {
			var key = evt.which;
			if(key === 1)
				selSfx.play();
			else
				scoreSfx.play(1);
		}
	}
	</script>
</body>
</html>